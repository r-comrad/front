import{a as h,v as k,b as C}from"./runtime-dom.esm-bundler-62d8dff8.js";import{a as g,U as y}from"./axios-99647cd3.js";import{r as $}from"./index-c91c4047.js";import{A as S,H as x,o as c,c as m,a as e,J as u,R as L,G as w,z as M,K as U,L as V,M as f,y as B,b as v}from"./runtime-core.esm-bundler-39f475bb.js";import{M as F}from"./bootstrap.esm-9a522539.js";import"./vue-router-dca7c9af.js";const N={class:"modal fade",id:"user","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"user","aria-hidden":"true"},O={class:"modal-dialog"},G={class:"modal-content"},D=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"Работа с юзером"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),E={class:"modal-body"},I={class:"mb-3"},J=e("label",{class:"form-label"},"Имя",-1),P={class:"mb-3"},R=e("label",{class:"form-label"},"Фамилия",-1),T={class:"mb-3"},j=e("label",{class:"form-label"},"Логин",-1),z=e("div",{class:"form-text"},"По этому логину будет осуществляться вход",-1),A={class:"mb-3"},H=e("label",{class:"form-label"},"Пароль",-1),K={class:"mb-3"},q=e("label",{class:"form-label"},"Выбрать роль",-1),Q=L('<option value="student">Обучающийся</option><option value="teacher">Педагог</option><option value="grade_head">Классный руководитель</option><option value="add_user">Разрешено управление юзерами</option><option value="add_journal">Разрешено управление журналами</option><option value="add_plan">Разрешено управление учебными планами</option><option value="add_grade">Разрешено управление классами</option>',7),W=[Q],X=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1),Y={__name:"UserModal",props:["user"],emits:["reGet"],setup(_,{emit:p}){const o=_,t=S({id:"",name:"",surname:"",login:"",password:"",roles:[""]});x(o,()=>{t.id=o.user.id,t.name=o.user.name,t.surname=o.user.surname,t.login=o.user.login,t.password=o.user.password,t.roles=o.user.roles});const d=()=>{let i=[];for(let s of t.role)i.push(s);g({method:"POST",url:y+"/post/user",data:{id:t.id===void 0?0:t.id,name:t.name,surname:t.surname,login:t.login,password:t.password,roles:i},headers:{token:JSON.parse(localStorage.getItem("user")).token}}).then(()=>{$.go()})};return(i,s)=>(c(),m("div",N,[e("div",O,[e("div",G,[D,e("div",E,[e("div",I,[J,u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=r=>t.name=r)},null,512),[[h,t.name]])]),e("div",P,[R,u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=r=>t.surname=r)},null,512),[[h,t.surname]])]),e("div",T,[j,u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=r=>t.login=r)},null,512),[[h,t.login]]),z]),e("div",A,[H,u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=r=>t.password=r)},null,512),[[h,t.password]])]),e("div",K,[q,u(e("select",{class:"form-control","onUpdate:modelValue":s[4]||(s[4]=r=>t.roles=r),multiple:""},W,512),[[k,t.roles]])])]),e("div",{class:"modal-footer"},[X,e("button",{type:"button",class:"btn btn-primary",onClick:d,"data-bs-dismiss":"modal"},"Сохранить")])])])]))}},Z={class:"row my-3"},ee={class:"col-2"},te=e("div",{class:"col-2"},[e("button",{type:"button",class:"btn btn-primary",disabled:""}," Загрузить через файл ")],-1),se={class:"col-2 ms-auto"},oe={__name:"ButtonBlock",emits:["setUser","setFilter"],setup(_,{emit:p}){return(o,t)=>(c(),m("div",Z,[e("div",ee,[e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=d=>o.$emit("setUser",{})),"data-bs-toggle":"modal","data-bs-target":"#user"}," Создать новых юзеров ")]),te,e("div",se,[e("input",{class:"form-control me-2",type:"search",placeholder:"Поиск","aria-label":"Search",onInput:t[1]||(t[1]=d=>o.$emit("setFilter",d.target.value))},null,32)])]))}},le={class:"table table-striped text-center"},ae=e("th",null,"Имя",-1),ne=e("th",null,"Роль",-1),re=e("th",null,"Логин",-1),de=e("th",{style:{width:"10%"}},"Изменить",-1),ie=["onClick"],ue=e("i",{class:"bi bi-pencil-fill"},null,-1),ce=[ue],me=["onUpdate:modelValue"],_e={__name:"UserList",props:["filter_by"],emits:["openModal"],setup(_,{emit:p}){const o=_,t=w([]);g.get(y+"/get/all/user").then(l=>{t.value=l.data.users.filter(a=>!a.role.includes("admin")&&!a.role.includes("director")||JSON.parse(localStorage.getItem("user")).role.includes("admin")),t.value.sort((a,n)=>s(a.role)>s(n.role)?1:s(a.role)<s(n.role)?-1:a.surname+a.name>n.surname+n.name?1:-1),t.value.forEach(a=>{a.to_delete=!1})});const d=l=>{const a={student:"Обучающийся",teacher:"Педагог",grade_head:"Кл. руководитель",add_user:"Упр. юзерами",add_journal:"Упр. журналом",add_plan:"Упр. планами",add_grade:"Упр. классами"};let n="";for(let b of l)n+=a[b]+" ";return n},i=M(()=>t.value.filter(l=>l.name.toLowerCase().includes(o.filter_by.toLowerCase())||l.surname.toLowerCase().includes(o.filter_by.toLowerCase())||l.login.toLowerCase().includes(o.filter_by.toLowerCase())||d(l.role).toLowerCase().includes(o.filter_by.toLowerCase()))),s=l=>l.includes("student")?1:l.includes("teacher")||l.includes("grade_head")?2:3,r=()=>{let l=[];t.value.forEach(a=>{a.to_delete&&l.push(a.id)}),g({method:"POST",url:y+"/drop_users",data:{users:l}}).then(a=>{$.go()})};return(l,a)=>(c(),m("table",le,[e("thead",null,[e("tr",null,[ae,ne,re,de,e("th",{style:{width:"10%"}},[e("button",{class:"btn btn-danger btn-sm",onClick:r},"Удалить")])])]),e("tbody",null,[(c(!0),m(U,null,V(B(i),n=>(c(),m("tr",null,[e("td",null,f(n.surname)+" "+f(n.name),1),e("td",null,f(d(n.role)),1),e("td",null,f(n.login),1),e("td",null,[e("button",{class:"btn btn-primary btn-sm",onClick:b=>l.$emit("openModal",n)},ce,8,ie)]),e("td",null,[u(e("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":b=>n.to_delete=b},null,8,me),[[C,n.to_delete]])])]))),256))])]))}},ye={__name:"MakeUser",setup(_){const p=w({}),o=i=>{p.value=i},t=i=>{o(i),new F("#user").toggle()},d=w("");return(i,s)=>(c(),m(U,null,[v(oe,{onSetUser:o,onSetFilter:s[0]||(s[0]=r=>{d.value=r})}),v(Y,{user:p.value},null,8,["user"]),v(_e,{onOpenModal:t,filter_by:d.value},null,8,["filter_by"])],64))}};export{ye as default};
