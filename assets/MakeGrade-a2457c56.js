import{b as w,a as x,v as L}from"./runtime-dom.esm-bundler-c45b8d01.js";import{a as h,U as f}from"./config-ecf8e2cb.js";import{r as $}from"./index-9d1c1e6a.js";import{G as i,H as S,z as C,o as u,c,a as e,J as y,K as M,L as g,I as k,y as G,A as B,b as v}from"./runtime-core.esm-bundler-866dbb67.js";import{M as U}from"./bootstrap.esm-9a522539.js";import{_ as V}from"./StudentsSearch-1e15b31e.js";const F={class:"table table-striped text-center"},O=e("th",null,"Имя",-1),I=e("th",null,"Классный руководитель",-1),N=e("th",{style:{width:"10%"}},"Изменить",-1),D=["onClick"],E=e("i",{class:"bi bi-pencil-fill"},null,-1),J=[E],P=["onUpdate:modelValue"],T={__name:"GradeList",props:["filter_by"],emits:["openModal"],setup(_,{emit:b}){const o=_,d=i([]),l=i([]),a=n=>(n[1]==="1"||n[1]==="0"||(n="0"+n),n);h.get(f+"/all_users").then(n=>{l.value=n.data.users}),S(l,()=>{h.get(f+"/all_grades").then(n=>{d.value=n.data.grades,d.value.sort((s,t)=>a(s.name)>a(t.name)?1:-1);for(let s of d.value)s.head=l.value.filter(t=>t.id===s.head)[0],s.head===void 0&&(s.head={});d.value.forEach(s=>{s.to_delete=!1})})});const m=C(()=>d.value.filter(n=>n.name.toLowerCase().includes(o.filter_by.toLowerCase()))),p=()=>{let n=[];d.value.forEach(s=>{s.to_delete&&n.push(s.id)}),h({method:"POST",url:f+"/drop_grades",data:{grades:n}}).then(s=>{$.go()})};return(n,s)=>(u(),c("table",F,[e("thead",null,[e("tr",null,[O,I,N,e("th",{style:{width:"10%"}},[e("button",{class:"btn btn-danger btn-sm",onClick:p},"Удалить")])])]),e("tbody",null,[(u(!0),c(y,null,M(G(m),t=>(u(),c("tr",null,[e("td",null,g(t.name),1),e("td",null,g(t.head.name)+" "+g(t.head.surname),1),e("td",null,[e("button",{class:"btn btn-primary btn-sm",onClick:r=>n.$emit("openModal",t)},J,8,D)]),e("td",null,[k(e("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":r=>t.to_delete=r},null,8,P),[[w,t.to_delete]])])]))),256))])]))}},z={class:"row my-3"},A={class:"col-2"},H={class:"col-2 ms-auto"},K={__name:"ButtonBlock",emits:["setGrade","setFilter"],setup(_,{emit:b}){return(o,d)=>(u(),c("div",z,[e("div",A,[e("button",{type:"button",class:"btn btn-primary",onClick:d[0]||(d[0]=l=>o.$emit("setGrade",{})),"data-bs-toggle":"modal","data-bs-target":"#grade"}," Создать новый класс ")]),e("div",H,[e("input",{class:"form-control me-2",type:"search",placeholder:"Поиск","aria-label":"Search",onInput:d[1]||(d[1]=l=>o.$emit("setFilter",l.target.value))},null,32)])]))}},R={class:"modal fade",id:"grade","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"grade","aria-hidden":"true"},j={class:"modal-dialog"},q={class:"modal-content"},Q=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"Работа с классом"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),W={class:"modal-body"},X={class:"mb-3"},Y=e("label",{class:"form-label"},"Имя",-1),Z={class:"mb-3"},ee=e("label",{class:"form-label"},"Классный руководитель",-1),te=["value"],se=e("div",{class:"mb-3"},[e("button",{class:"btn btn-primary","data-bs-target":"#student_search","data-bs-toggle":"modal"}," Выбрать обучающихся ")],-1),ae={class:"modal-footer"},ne=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1),oe={__name:"GradeModal",props:["grade"],emits:["reGet"],setup(_,{emit:b}){const o=_,d=i([]),l=i([]);h.get(f+"/all_users").then(s=>{d.value=s.data.users.filter(t=>!t.role.includes("student")),l.value=s.data.users.filter(t=>t.role.includes("student"))});const a=B({id:"",name:"",students:[""],head:{}});i(""),S(o,()=>{a.id=o.grade.id===void 0?0:o.grade.id,a.name=o.grade.name,a.students=o.grade.students===void 0?[]:o.grade.students,a.head=o.grade.head});const m=C(()=>{let s=[];if(o.grade.students)for(let t of o.grade.students)s.push(t.id);return s}),p=()=>{let s=[];if(a.students)for(let t of a.students)s.push(t.id);h({url:f+"/manage_grade",method:"POST",data:{id:a.id,name:a.name,head:a.head.id,students:s},headers:{token:JSON.parse(localStorage.getItem("user")).token}}).then(t=>{$.go()})},n=s=>{a.students=s};return i(),(s,t)=>(u(),c(y,null,[v(V,{"back-i-d":"#grade",students:l.value,selected:G(m),onMakeList:n,id:"student_search"},null,8,["students","selected"]),e("div",R,[e("div",j,[e("div",q,[Q,e("div",W,[e("div",X,[Y,k(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=r=>a.name=r)},null,512),[[x,a.name]])]),e("div",Z,[ee,k(e("select",{class:"form-control","onUpdate:modelValue":t[1]||(t[1]=r=>a.head=r)},[(u(!0),c(y,null,M(d.value,r=>(u(),c("option",{value:r},g(r.name)+" "+g(r.surname),9,te))),256))],512),[[L,a.head]])]),se]),e("div",ae,[e("button",{type:"button",class:"btn btn-outline-primary me-auto",onClick:t[2]||(t[2]=r=>G($).push({name:"group_management",params:{grade:JSON.stringify(a)}})),"data-bs-dismiss":"modal"},"Открыть группы"),ne,e("button",{type:"button",class:"btn btn-primary",onClick:p,"data-bs-dismiss":"modal"},"Сохранить")])])])])],64))}},me={__name:"MakeGrade",setup(_){const b=i(""),o=a=>{b.value=a},d=a=>{o(a),new U("#grade").toggle()},l=i("");return(a,m)=>(u(),c(y,null,[v(K,{onSetGrade:o,onSetFilter:m[0]||(m[0]=p=>{l.value=p})}),v(oe,{grade:b.value},null,8,["grade"]),v(T,{filter_by:l.value,onOpenModal:d},null,8,["filter_by"])],64))}};export{me as default};
