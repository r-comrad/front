import{b as C,a as P,v as j}from"./runtime-dom.esm-bundler-c45b8d01.js";import{a as b,U as h,F as w}from"./config-ecf8e2cb.js";import{r as k}from"./index-9d1c1e6a.js";import{G as p,z as x,o as d,c,a as t,J as $,K as g,L as v,I as y,y as S,A as F,H as L,M,b as f}from"./runtime-core.esm-bundler-866dbb67.js";import{M as V}from"./bootstrap.esm-9a522539.js";const B={class:"table table-striped text-center"},U=t("th",null,"Имя",-1),T=t("th",null,"Предмет",-1),E=t("th",{style:{width:"10%"}},"Изменить",-1),I=["onClick"],N=t("i",{class:"bi bi-pencil-fill"},null,-1),O=[N],D=["onUpdate:modelValue"],A={__name:"PlanList",props:["filter_by"],emits:["setPlan"],setup(m,{emit:_}){const l=m,e=p([]);b.get(h+"/all_plans").then(a=>{e.value=a.data.plans.sort((i,s)=>i.name>s.name?1:-1),e.value.forEach(i=>{i.to_delete=!1})});const o=x(()=>e.value.filter(a=>a.name.toLowerCase().includes(l.filter_by.toLowerCase())||a.subject.toLowerCase().includes(l.filter_by.toLowerCase()))),r=()=>{let a=[];e.value.forEach(i=>{i.to_delete&&a.push(i.id)}),b({method:"POST",url:h+"/drop_plans",data:{plans:a}}).then(i=>{k.go()})};return(a,i)=>(d(),c("table",B,[t("thead",null,[t("tr",null,[U,T,E,t("th",{style:{width:"10%"}},[t("button",{class:"btn btn-danger btn-sm",onClick:r},"Удалить")])])]),t("tbody",null,[(d(!0),c($,null,g(S(o),s=>(d(),c("tr",null,[t("td",null,v(s.name),1),t("td",null,v(s.subject),1),t("td",null,[t("button",{class:"btn btn-primary btn-sm",onClick:n=>a.$emit("setPlan",s)},O,8,I)]),t("td",null,[y(t("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":n=>s.to_delete=n},null,8,D),[[C,s.to_delete]])])]))),256))])]))}},G={class:"row my-3"},J={class:"col-2"},R={class:"col-2 ms-auto"},z={__name:"ButtonBlock",emits:["setPlan","setFilter"],setup(m,{emit:_}){return(l,e)=>(d(),c("div",G,[t("div",J,[t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=o=>l.$emit("setPlan",{}))}," Создать новый план ")]),t("div",R,[t("input",{class:"form-control me-2",type:"search",placeholder:"Поиск","aria-label":"Search",onInput:e[1]||(e[1]=o=>l.$emit("setFilter",o.target.value))},null,32)])]))}},H={class:"modal fade",id:"plan","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-hidden":"true"},K={class:"modal-dialog"},q={class:"modal-content"},Q=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"Работа с планами"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),W={class:"modal-body"},X={class:"mb-3"},Y=t("label",{class:"form-label"},"Имя",-1),Z={class:"mb-3"},tt=t("label",{class:"form-label"},"Предмет",-1),et=["value"],st=t("div",{class:"form-text"},"Это короткое имя которое будет видеть педагог",-1),lt={class:"mb-3"},at=t("label",{class:"form-label"},"Файл плана",-1),nt=["href"],ot=t("div",{class:"form-text"},"Планы автоматически обработаются в системе",-1),rt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1),it={__name:"PlanModal",props:["plan"],emits:["reGet"],setup(m,{emit:_}){const l=m,e=F({id:"",name:"",subject:"",url:""});L(l,()=>{e.id=l.plan.id===void 0?0:l.plan.id,e.name=l.plan.name,e.subject=l.plan.subject,e.url=l.plan.url===void 0?"":l.plan.url});const o=p([]);b.get(h+"/subjects").then(s=>{o.value=s.data.subjects});const r=p(),a=s=>o.value.filter(n=>n.name===s)[0].id,i=()=>{let s={};s.id=e.id,s.subject_id=a(e.subject),s.name=e.name,r.value!==void 0&&(s.filename=r.value.name,s.file=r.value),console.log(s),b({url:h+"/manage_plan",method:"POST",data:s,headers:{"Content-Type":"multipart/form-data",token:JSON.parse(localStorage.getItem("user")).token}}).then(n=>{k.go()})};return(s,n)=>(d(),c("div",H,[t("div",K,[t("div",q,[Q,t("div",W,[t("div",X,[Y,y(t("input",{type:"text",class:"form-control","onUpdate:modelValue":n[0]||(n[0]=u=>e.name=u)},null,512),[[P,e.name]])]),t("div",Z,[tt,y(t("select",{class:"form-select","onUpdate:modelValue":n[1]||(n[1]=u=>e.subject=u)},[(d(!0),c($,null,g(o.value,u=>(d(),c("option",{value:u.name},v(u.name),9,et))),256))],512),[[j,e.subject]]),st]),t("div",lt,[at,t("p",null,[e.url!==""?(d(),c("a",{key:0,href:S(w)+"/"+e.url,download:""},"Скачать текущий план",8,nt)):M("",!0)]),t("input",{type:"file",class:"form-control",onChange:n[2]||(n[2]=u=>{r.value=u.target.files[0]})},null,32),ot])]),t("div",{class:"modal-footer"},[rt,t("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:i},"Сохранить")])])])]))}},pt={__name:"MakePlan",setup(m){const _=p(""),l=r=>{_.value=r},e=p(""),o=r=>{e.value=r,new V("#plan").toggle()};return(r,a)=>(d(),c($,null,[f(it,{plan:e.value},null,8,["plan"]),f(z,{onSetFilter:l,onSetPlan:o}),f(A,{filter_by:_.value,onSetPlan:o},null,8,["filter_by"])],64))}};export{pt as default};
