import{b as x,v as C,a as k}from"./runtime-dom.esm-bundler-c45b8d01.js";import{a as b,U as f}from"./config-ecf8e2cb.js";import{G as m,H as L,z as M,o as n,c as u,a as e,J as $,K as U,L as h,I as _,y as N,M as S,b as J}from"./runtime-core.esm-bundler-866dbb67.js";import{M as j}from"./bootstrap.esm-9a522539.js";import{r as B}from"./index-9d1c1e6a.js";const F={class:"table table-striped text-center"},O=e("th",null,"Учебный план",-1),I=e("th",null,"Группа/Класс",-1),D=e("th",null,"Учитель",-1),E=e("th",{style:{width:"10%"}},"Изменить",-1),G=["onClick"],T=e("i",{class:"bi bi-pencil-fill"},null,-1),z=[T],H=["onUpdate:modelValue"],K={__name:"JournalList",props:["filter_by"],emits:["openModal"],setup(V,{emit:y}){const p=V,i=m([]),c=m([]),d=m([]),v=m([]);b.get(f+"/all_grades").then(r=>{c.value=r.data.grades}),b.get(f+"/all_users").then(r=>{v.value=r.data.users}),b.get(f+"/all_groups").then(r=>{d.value=r.data.groups}),L([c,v,d],()=>{d.value!==[]&&c.value!==[]&&v.value!==[]&&b.get(f+"/all_journals_simple/"+JSON.parse(localStorage.getItem("user")).id).then(r=>{i.value=r.data.journals,i.value.forEach(o=>{o.to_delete=!1,o.teacher_id=v.value.filter(t=>t.id===o.teacher_id)[0],o.teacher_id===void 0&&(o.teacher_id={}),o.is_group?o.group_id=d.value.filter(t=>t.id===o.group_id)[0]:o.group_id=c.value.filter(t=>t.id===o.group_id)[0]})})});const a=()=>{},s=M(()=>i.value.filter(r=>r.planName.toLowerCase().includes(p.filter_by.toLowerCase())||r.group_id.name.toLowerCase().includes(p.filter_by.toLowerCase())||r.teacher_id.name.toLowerCase().includes(p.filter_by.toLowerCase())));return(r,o)=>(n(),u("table",F,[e("thead",null,[e("tr",null,[O,I,D,E,e("th",{style:{width:"10%"}},[e("button",{class:"btn btn-danger btn-sm",onClick:a},"Удалить")])])]),e("tbody",null,[(n(!0),u($,null,U(N(s),t=>(n(),u("tr",null,[e("td",null,h(t.planName),1),e("td",null,h(t.group_id.name),1),e("td",null,h(t.teacher_id.name)+" "+h(t.teacher_id.surname),1),e("td",null,[e("button",{class:"btn btn-primary btn-sm",onClick:l=>r.$emit("openModal",t)},z,8,G)]),e("td",null,[_(e("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":l=>t.to_delete=l},null,8,H),[[x,t.to_delete]])])]))),256))])]))}},P={class:"row my-3"},R={class:"col-2"},q={class:"col-2 ms-auto"},A={name:"ButtonBlock"},Q=Object.assign(A,{emits:["setJournal","setFilter"],setup(V,{emit:y}){return(p,i)=>(n(),u("div",P,[e("div",R,[e("button",{type:"button",class:"btn btn-primary",onClick:i[0]||(i[0]=c=>p.$emit("setJournal",{})),"data-bs-toggle":"modal","data-bs-target":"#journal"}," Создать новый журнал ")]),e("div",q,[e("input",{class:"form-control me-2",type:"search",placeholder:"Поиск","aria-label":"Search",onInput:i[1]||(i[1]=c=>p.$emit("setFilter",c.target.value))},null,32)])]))}}),W={class:"modal fade",id:"journal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-hidden":"true"},X={class:"modal-dialog"},Y={class:"modal-content"},Z=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"Работа с журналами"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ee={class:"modal-body"},te={class:"mb-3"},le=e("label",{class:"form-label"},"Учитель",-1),se=["value"],oe=e("div",{class:"form-text"},"Роль учителя автоматически вытавится после сохранения",-1),ae={class:"mb-3"},ne=e("label",{class:"form-label"},"Учебный план",-1),ue=["value"],re={class:"form-check mb-3"},de=e("label",{class:"form-check-label"},"Прикрепить к группе",-1),ie={key:0,class:"mb-3"},ce=e("label",{class:"form-label"},"Выбрать группу",-1),_e=["value"],me={key:1,class:"mb-3"},pe=e("label",{class:"form-label"},"Выбрать класс",-1),ve=["value"],be={class:"mb-3"},fe=e("label",{class:"form-label"},"Рассписание",-1),he={class:"table"},ge=e("td",null,"Понедельник",-1),ye=e("td",null,"Вторник",-1),ke=e("td",null,"Среда",-1),$e=e("td",null,"Четверг",-1),Ve=e("td",null,"Пятница",-1),Ue=e("td",null,"Суббота",-1),Ce=e("td",null,"Воскресенье",-1),Je=e("div",{class:"form-text"},"Выберите количество уроков на каждый день недели",-1),we=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1),Se={__name:"JournalModal",props:["currentJournal"],setup(V){const y=V,p=m([]),i=m([]),c=m([]),d=m([]),v=m([]);b.get(f+"/all_grades").then(o=>{i.value=o.data.grades}),b.get(f+"/subjects").then(o=>{v.value=o.data.subject}),b.get(f+"/all_users").then(o=>{c.value=o.data.users.filter(t=>!t.role.includes("student"))}),b.get(f+"/all_groups").then(o=>{p.value=o.data.groups}),b.get(f+"/all_plans").then(o=>{d.value=o.data.plans});const a=m([0,0,0,0,0,0,0]),s=m({});L(y,()=>{if(s.value=y.currentJournal,s.value.id===void 0&&(s.value.id=0),s.value.is_group===void 0&&(s.value.is_group=!1),s.value.schedule!==void 0)for(let o of s.value.schedule)a.value[o-1]+=1});const r=()=>{let o=JSON.parse(localStorage.getItem("user")),t=[];for(let g=1;g<7;g++)for(let w=0;w<a.value[g-1];w++)t.push(g);let l={id:s.value.id,teacher_id:s.value.teacher_id.id,methodist:o.id,is_group:s.value.is_group,group_id:s.value.group_id.id,subject:d.value.filter(g=>g.name===s.value.planName)[0].subject,plan:d.value.filter(g=>g.name===s.value.planName)[0].id,school:o.school,schedule:t};b({method:"POST",url:f+"/manage_journal",data:l}).then(()=>{B.go()}),console.log(l)};return(o,t)=>(n(),u("div",W,[e("div",X,[e("div",Y,[Z,e("div",ee,[e("div",te,[le,_(e("select",{class:"form-select","onUpdate:modelValue":t[0]||(t[0]=l=>s.value.teacher_id=l)},[(n(!0),u($,null,U(c.value,l=>(n(),u("option",{value:l},h(l.name)+" "+h(l.surname),9,se))),256))],512),[[C,s.value.teacher_id]]),oe]),e("div",ae,[ne,_(e("select",{class:"form-select","onUpdate:modelValue":t[1]||(t[1]=l=>s.value.planName=l)},[(n(!0),u($,null,U(d.value,l=>(n(),u("option",{value:l.name},h(l.name),9,ue))),256))],512),[[C,s.value.planName]])]),e("div",re,[_(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=l=>s.value.is_group=l)},null,512),[[x,s.value.is_group]]),de]),s.value.is_group?(n(),u("div",ie,[ce,_(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=l=>s.value.group_id=l)},[(n(!0),u($,null,U(p.value,l=>(n(),u("option",{value:l},h(l.name),9,_e))),256))],512),[[C,s.value.group_id]])])):S("",!0),s.value.is_group?S("",!0):(n(),u("div",me,[pe,_(e("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=l=>s.value.group_id=l)},[(n(!0),u($,null,U(i.value,l=>(n(),u("option",{value:l},h(l.name),9,ve))),256))],512),[[C,s.value.group_id]])])),e("div",be,[fe,e("table",he,[e("tr",null,[ge,e("td",null,[_(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":t[5]||(t[5]=l=>a.value[0]=l)},null,512),[[k,a.value[0]]])])]),e("tr",null,[ye,e("td",null,[_(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":t[6]||(t[6]=l=>a.value[1]=l)},null,512),[[k,a.value[1]]])])]),e("tr",null,[ke,e("td",null,[_(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":t[7]||(t[7]=l=>a.value[2]=l)},null,512),[[k,a.value[2]]])])]),e("tr",null,[$e,e("td",null,[_(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":t[8]||(t[8]=l=>a.value[3]=l)},null,512),[[k,a.value[3]]])])]),e("tr",null,[Ve,e("td",null,[_(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":t[9]||(t[9]=l=>a.value[4]=l)},null,512),[[k,a.value[4]]])])]),e("tr",null,[Ue,e("td",null,[_(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":t[10]||(t[10]=l=>a.value[5]=l)},null,512),[[k,a.value[5]]])])]),e("tr",null,[Ce,e("td",null,[_(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":t[11]||(t[11]=l=>a.value[6]=l)},null,512),[[k,a.value[6]]])])])]),Je])]),e("div",{class:"modal-footer"},[we,e("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:r},"Сохранить")])])])]))}},Be={__name:"MakeJournal",setup(V){const y=m(""),p=d=>{y.value=d},i=d=>{p(d),new j("#journal").toggle()},c=m("");return(d,v)=>(n(),u($,null,[J(Q,{onSetJournal:p,onSetFilter:v[0]||(v[0]=a=>{c.value=a})}),J(Se,{"current-journal":y.value},null,8,["current-journal"]),J(K,{filter_by:c.value,onOpenModal:i},null,8,["filter_by"])],64))}};export{Be as default};
