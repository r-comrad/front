import{b as x,v as C,a as f}from"./runtime-dom.esm-bundler-62d8dff8.js";import{a as g,U as y}from"./axios-99647cd3.js";import{G as i,z as L,o as a,c as n,a as e,K as k,L as V,M as b,J as d,y as M,H as j,N as S,b as J}from"./runtime-core.esm-bundler-39f475bb.js";import{M as N}from"./bootstrap.esm-9a522539.js";import{r as B}from"./index-c91c4047.js";import"./vue-router-dca7c9af.js";const F={class:"table table-striped text-center"},O=e("th",null,"Учебный план",-1),D=e("th",null,"Группа/Класс",-1),I=e("th",null,"Учитель",-1),G=e("th",{style:{width:"10%"}},"Изменить",-1),T=["onClick"],z=e("i",{class:"bi bi-pencil-fill"},null,-1),E=[z],H=["onUpdate:modelValue"],K={__name:"JournalList",props:["filter_by"],emits:["openModal"],setup($,{emit:h}){const c=$,m=i([]);i([]),i([]),i([]),g.get(y+"/get/if/journal_table[*;teacher_id[*];plan_id[*];group_id[*]]/methodist_id="+JSON.parse(localStorage.getItem("user")).id).then(r=>{m.value=r.data.journal_tables});const p=()=>{},_=L(()=>m.value.filter(r=>r.plan.name.toLowerCase().includes(c.filter_by.toLowerCase())||r.group.name.toLowerCase().includes(c.filter_by.toLowerCase())||r.teacher.name.toLowerCase().includes(c.filter_by.toLowerCase())));return(r,s)=>(a(),n("table",F,[e("thead",null,[e("tr",null,[O,D,I,G,e("th",{style:{width:"10%"}},[e("button",{class:"btn btn-danger btn-sm",onClick:p},"Удалить")])])]),e("tbody",null,[(a(!0),n(k,null,V(M(_),l=>(a(),n("tr",null,[e("td",null,b(l.plan.name),1),e("td",null,b(l.group.name),1),e("td",null,b(l.teacher.name)+" "+b(l.teacher.surname),1),e("td",null,[e("button",{class:"btn btn-primary btn-sm",onClick:U=>r.$emit("openModal",l)},E,8,T)]),e("td",null,[d(e("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":U=>l.to_delete=U},null,8,H),[[x,l.to_delete]])])]))),256))])]))}},P={class:"row my-3"},R={class:"col-2"},q={class:"col-2 ms-auto"},A={name:"ButtonBlock"},Q=Object.assign(A,{emits:["setJournal","setFilter"],setup($,{emit:h}){return(c,m)=>(a(),n("div",P,[e("div",R,[e("button",{type:"button",class:"btn btn-primary",onClick:m[0]||(m[0]=p=>c.$emit("setJournal",{})),"data-bs-toggle":"modal","data-bs-target":"#journal"}," Создать новый журнал ")]),e("div",q,[e("input",{class:"form-control me-2",type:"search",placeholder:"Поиск","aria-label":"Search",onInput:m[1]||(m[1]=p=>c.$emit("setFilter",p.target.value))},null,32)])]))}}),W={class:"modal fade",id:"journal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-hidden":"true"},X={class:"modal-dialog"},Y={class:"modal-content"},Z=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"Работа с журналами"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ee={class:"modal-body"},te={class:"mb-3"},le=e("label",{class:"form-label"},"Учитель",-1),oe=["value"],se=e("div",{class:"form-text"},"Роль учителя автоматически вытавится после сохранения",-1),ae={class:"mb-3"},ne=e("label",{class:"form-label"},"Учебный план",-1),ue=["value"],re={class:"form-check mb-3"},de=e("label",{class:"form-check-label"},"Прикрепить к группе",-1),ie={key:0,class:"mb-3"},ce=e("label",{class:"form-label"},"Выбрать группу",-1),me=["value"],_e={key:1,class:"mb-3"},pe=e("label",{class:"form-label"},"Выбрать класс ",-1),be=["value"],ve={class:"mb-3"},he=e("label",{class:"form-label"},"Рассписание",-1),fe={class:"table"},ge=e("td",null,"Понедельник",-1),ye=e("td",null,"Вторник",-1),ke=e("td",null,"Среда",-1),$e=e("td",null,"Четверг",-1),Ve=e("td",null,"Пятница",-1),Ue=e("td",null,"Суббота",-1),Ce=e("td",null,"Воскресенье",-1),Je=e("div",{class:"form-text"},"Выберите количество уроков на каждый день недели",-1),we=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1),Se={__name:"JournalModal",props:["currentJournal"],setup($){const h=$,c=i([]),m=i([]),p=i([]),_=i([]),r=i([]);g.get(y+"/get/all/grade[*]").then(u=>{m.value=u.data.grades}),g.get(y+"/get/all/subject[*]").then(u=>{r.value=u.data.subjects}),g.get(y+"/get/all/user[*]").then(u=>{p.value=u.data.users.filter(o=>!o.role.includes("student"))}),g.get(y+"/get/all/group[*]").then(u=>{c.value=u.data.groups}),g.get(y+"/get/all/plan[*]").then(u=>{_.value=u.data.plans});const s=i([0,0,0,0,0,0,0]),l=i({});j(h,()=>{if(l.value=h.currentJournal,l.value.id===void 0&&(l.value.id=0),l.value.is_group===void 0&&(l.value.is_group=!1),l.value.schedule!==void 0)for(let u of l.value.schedule)s.value[u-1]+=1});const U=()=>{let u=JSON.parse(localStorage.getItem("user")),o=[];for(let v=1;v<7;v++)for(let w=0;w<s.value[v-1];w++)o.push(v);let t={id:l.value.id,teacher_id:l.value.teacher_id.id,methodist:u.id,is_group:l.value.is_group,group_id:l.value.group_id.id,subject:_.value.filter(v=>v.name===l.value.planName)[0].subject,plan:_.value.filter(v=>v.name===l.value.planName)[0].id,school:u.school,schedule:o};g({method:"POST",url:y+"/manage_journal",data:t}).then(()=>{B.go()}),console.log(t)};return(u,o)=>(a(),n("div",W,[e("div",X,[e("div",Y,[Z,e("div",ee,[e("div",te,[le,d(e("select",{class:"form-select","onUpdate:modelValue":o[0]||(o[0]=t=>l.value.teacher=t)},[(a(!0),n(k,null,V(p.value,t=>(a(),n("option",{value:t},b(t.name)+" "+b(t.surname),9,oe))),256))],512),[[C,l.value.teacher]]),se]),e("div",ae,[ne,d(e("select",{class:"form-select","onUpdate:modelValue":o[1]||(o[1]=t=>l.value.plan=t)},[(a(!0),n(k,null,V(_.value,t=>(a(),n("option",{value:t},b(t.name),9,ue))),256))],512),[[C,l.value.plan]])]),e("div",re,[d(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=t=>l.value.is_group=t)},null,512),[[x,l.value.is_group]]),de]),l.value.is_group?(a(),n("div",ie,[ce,d(e("select",{class:"form-select","onUpdate:modelValue":o[3]||(o[3]=t=>l.value.group=t)},[(a(!0),n(k,null,V(c.value,t=>(a(),n("option",{value:t},b(t.name),9,me))),256))],512),[[C,l.value.group]])])):S("",!0),l.value.is_group?S("",!0):(a(),n("div",_e,[pe,d(e("select",{class:"form-select","onUpdate:modelValue":o[4]||(o[4]=t=>l.value.group=t)},[(a(!0),n(k,null,V(m.value,t=>(a(),n("option",{value:t},b(t.name),9,be))),256))],512),[[C,l.value.group]])])),e("div",ve,[he,e("table",fe,[e("tr",null,[ge,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":o[5]||(o[5]=t=>s.value[0]=t)},null,512),[[f,s.value[0]]])])]),e("tr",null,[ye,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":o[6]||(o[6]=t=>s.value[1]=t)},null,512),[[f,s.value[1]]])])]),e("tr",null,[ke,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":o[7]||(o[7]=t=>s.value[2]=t)},null,512),[[f,s.value[2]]])])]),e("tr",null,[$e,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":o[8]||(o[8]=t=>s.value[3]=t)},null,512),[[f,s.value[3]]])])]),e("tr",null,[Ve,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":o[9]||(o[9]=t=>s.value[4]=t)},null,512),[[f,s.value[4]]])])]),e("tr",null,[Ue,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":o[10]||(o[10]=t=>s.value[5]=t)},null,512),[[f,s.value[5]]])])]),e("tr",null,[Ce,e("td",null,[d(e("input",{type:"number",min:"0",class:"form-control border-0","onUpdate:modelValue":o[11]||(o[11]=t=>s.value[6]=t)},null,512),[[f,s.value[6]]])])])]),Je])]),e("div",{class:"modal-footer"},[we,e("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:U},"Сохранить")])])])]))}},Fe={__name:"MakeJournal",setup($){const h=i(""),c=_=>{h.value=_},m=_=>{c(_),new N("#journal").toggle()},p=i("");return(_,r)=>(a(),n(k,null,[J(Q,{onSetJournal:c,onSetFilter:r[0]||(r[0]=s=>{p.value=s})}),J(Se,{"current-journal":h.value},null,8,["current-journal"]),J(K,{filter_by:p.value,onOpenModal:m},null,8,["filter_by"])],64))}};export{Fe as default};
