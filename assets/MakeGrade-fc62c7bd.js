import{b as C,a as w,v as x}from"./runtime-dom.esm-bundler-62d8dff8.js";import{a as h,U as g}from"./axios-99647cd3.js";import{r as $}from"./index-c91c4047.js";import{G as u,z as S,o as c,c as m,a as t,K as y,L as M,M as f,J as k,y as G,A as L,H as B,b as v}from"./runtime-core.esm-bundler-39f475bb.js";import{M as U}from"./bootstrap.esm-9a522539.js";import{_ as V}from"./StudentsSearch-20dd47c0.js";import"./vue-router-dca7c9af.js";const F={class:"table table-striped text-center"},O=t("th",null,"Имя",-1),N=t("th",null,"Классный руководитель",-1),D=t("th",{style:{width:"10%"}},"Изменить",-1),E=["onClick"],I=t("i",{class:"bi bi-pencil-fill"},null,-1),J=[I],P=["onUpdate:modelValue"],T={__name:"GradeList",props:["filter_by"],emits:["openModal"],setup(b,{emit:p}){const l=b,d=u([]);u([]);const n=o=>(o[1]==="1"||o[1]==="0"||(o="0"+o),o);h.get(g+"/get/all/grade[*;head_id[id;name;surname;role_id]]").then(o=>{d.value=o.data.grades,d.value.sort((r,e)=>n(r.name)>n(e.name)?1:-1),d.value.forEach(r=>{r.to_delete=!1})});const s=S(()=>d.value.filter(o=>o.name.toLowerCase().includes(l.filter_by.toLowerCase()))),_=()=>{let o=[];d.value.forEach(r=>{r.to_delete&&o.push(r.id)}),h({method:"POST",url:g+"/drop_grades",data:{grades:o}}).then(r=>{$.go()})};return(o,r)=>(c(),m("table",F,[t("thead",null,[t("tr",null,[O,N,D,t("th",{style:{width:"10%"}},[t("button",{class:"btn btn-danger btn-sm",onClick:_},"Удалить")])])]),t("tbody",null,[(c(!0),m(y,null,M(G(s),e=>(c(),m("tr",null,[t("td",null,f(e.name),1),t("td",null,f(e.head.name)+" "+f(e.head.surname),1),t("td",null,[t("button",{class:"btn btn-primary btn-sm",onClick:a=>o.$emit("openModal",e)},J,8,E)]),t("td",null,[k(t("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":a=>e.to_delete=a},null,8,P),[[C,e.to_delete]])])]))),256))])]))}},z={class:"row my-3"},A={class:"col-2"},H={class:"col-2 ms-auto"},K={__name:"ButtonBlock",emits:["setGrade","setFilter"],setup(b,{emit:p}){return(l,d)=>(c(),m("div",z,[t("div",A,[t("button",{type:"button",class:"btn btn-primary",onClick:d[0]||(d[0]=n=>l.$emit("setGrade",{})),"data-bs-toggle":"modal","data-bs-target":"#grade"}," Создать новый класс ")]),t("div",H,[t("input",{class:"form-control me-2",type:"search",placeholder:"Поиск","aria-label":"Search",onInput:d[1]||(d[1]=n=>l.$emit("setFilter",n.target.value))},null,32)])]))}},R={class:"modal fade",id:"grade","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"grade","aria-hidden":"true"},j={class:"modal-dialog"},q={class:"modal-content"},Q=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"Работа с классом"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),W={class:"modal-body"},X={class:"mb-3"},Y=t("label",{class:"form-label"},"Имя",-1),Z={class:"mb-3"},tt=t("label",{class:"form-label"},"Классный руководитель",-1),et=["value"],st=t("div",{class:"mb-3"},[t("button",{class:"btn btn-primary","data-bs-target":"#student_search","data-bs-toggle":"modal"}," Выбрать обучающихся ")],-1),at={class:"modal-footer"},ot=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1),dt={__name:"GradeModal",props:["grade"],emits:["reGet"],setup(b,{emit:p}){const l=b,d=u([]),n=u([]);h.get(g+"/get/all/user[id;name;surname;role_id]").then(e=>{d.value=e.data.users.filter(a=>!a.role.includes("student")),n.value=e.data.users.filter(a=>a.role.includes("student"))});const s=L({id:"",name:"",students:[""],head:{}});u(""),B(l,()=>{h.get(g+"/get/by_id/grade(grade_student[student_id[name;surname;id;role_id]])[*;head_id[id;name;surname;role_id]]/"+l.grade.id).then(e=>{s.id=e.data.grade.id,s.name=e.data.grade.name,console.log(e.data.grade),s.head=e.data.grade.head;let a=[];for(let i of e.data.grade.grade_students)a.push(i.student);s.students=a})});const _=S(()=>{let e=[];if(s.students)for(let a of s.students)e.push(a.id);return e}),o=()=>{let e=[];if(s.students)for(let a of s.students)e.push(a.id);h({url:g+"/manage_grade",method:"POST",data:{id:s.id,name:s.name,head:s.head.id,students:e},headers:{token:JSON.parse(localStorage.getItem("user")).token}}).then(a=>{$.go()})},r=e=>{s.students=e};return u(),(e,a)=>(c(),m(y,null,[v(V,{"back-i-d":"#grade",students:n.value,selected:G(_),onMakeList:r,id:"student_search"},null,8,["students","selected"]),t("div",R,[t("div",j,[t("div",q,[Q,t("div",W,[t("div",X,[Y,k(t("input",{type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=i=>s.name=i)},null,512),[[w,s.name]])]),t("div",Z,[tt,k(t("select",{class:"form-control","onUpdate:modelValue":a[1]||(a[1]=i=>s.head=i)},[(c(!0),m(y,null,M(d.value,i=>(c(),m("option",{value:i},f(i.name)+" "+f(i.surname),9,et))),256))],512),[[x,s.head]])]),st]),t("div",at,[t("button",{type:"button",class:"btn btn-outline-primary me-auto",onClick:a[2]||(a[2]=i=>G($).push({name:"group_management",params:{grade:JSON.stringify(s)}})),"data-bs-dismiss":"modal"},"Открыть группы"),ot,t("button",{type:"button",class:"btn btn-primary",onClick:o,"data-bs-dismiss":"modal"},"Сохранить")])])])])],64))}},_t={__name:"MakeGrade",setup(b){const p=u(""),l=s=>{p.value=s},d=s=>{l(s),new U("#grade").toggle()},n=u("");return(s,_)=>(c(),m(y,null,[v(K,{onSetGrade:l,onSetFilter:_[0]||(_[0]=o=>{n.value=o})}),v(dt,{grade:p.value},null,8,["grade"]),v(T,{filter_by:n.value,onOpenModal:d},null,8,["filter_by"])],64))}};export{_t as default};
