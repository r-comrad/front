import{b as C,a as P,v as j}from"./runtime-dom.esm-bundler-62d8dff8.js";import{a as b,U as h,F as w}from"./axios-99647cd3.js";import{r as g}from"./index-c91c4047.js";import{G as p,z as x,o as i,c as d,a as t,K as $,L as k,M as v,J as y,y as S,A as F,H as L,N as M,b as f}from"./runtime-core.esm-bundler-39f475bb.js";import{M as V}from"./bootstrap.esm-9a522539.js";import"./vue-router-dca7c9af.js";const B={class:"table table-striped text-center"},U=t("th",null,"Имя",-1),N=t("th",null,"Предмет",-1),T=t("th",{style:{width:"10%"}},"Изменить",-1),E=["onClick"],O=t("i",{class:"bi bi-pencil-fill"},null,-1),D=[O],I=["onUpdate:modelValue"],A={__name:"PlanList",props:["filter_by"],emits:["setPlan"],setup(m,{emit:_}){const l=m,e=p([]);b.get(h+"/get/all/plan[*;subject_id[*]]").then(a=>{e.value=a.data.plans.sort((r,s)=>r.name>s.name?1:-1),e.value.forEach(r=>{r.to_delete=!1})});const n=x(()=>e.value.filter(a=>a.name.toLowerCase().includes(l.filter_by.toLowerCase())||a.subject.toLowerCase().includes(l.filter_by.toLowerCase()))),c=()=>{let a=[];e.value.forEach(r=>{r.to_delete&&a.push(r.id)}),b({method:"POST",url:h+"/drop_plans",data:{plans:a}}).then(r=>{g.go()})};return(a,r)=>(i(),d("table",B,[t("thead",null,[t("tr",null,[U,N,T,t("th",{style:{width:"10%"}},[t("button",{class:"btn btn-danger btn-sm",onClick:c},"Удалить")])])]),t("tbody",null,[(i(!0),d($,null,k(S(n),s=>(i(),d("tr",null,[t("td",null,v(s.name),1),t("td",null,v(s.subject.name),1),t("td",null,[t("button",{class:"btn btn-primary btn-sm",onClick:o=>a.$emit("setPlan",s)},D,8,E)]),t("td",null,[y(t("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":o=>s.to_delete=o},null,8,I),[[C,s.to_delete]])])]))),256))])]))}},G={class:"row my-3"},J={class:"col-2"},R={class:"col-2 ms-auto"},z={__name:"ButtonBlock",emits:["setPlan","setFilter"],setup(m,{emit:_}){return(l,e)=>(i(),d("div",G,[t("div",J,[t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=n=>l.$emit("setPlan",{}))}," Создать новый план ")]),t("div",R,[t("input",{class:"form-control me-2",type:"search",placeholder:"Поиск","aria-label":"Search",onInput:e[1]||(e[1]=n=>l.$emit("setFilter",n.target.value))},null,32)])]))}},H={class:"modal fade",id:"plan","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-hidden":"true"},K={class:"modal-dialog"},q={class:"modal-content"},Q=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"Работа с планами"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),W={class:"modal-body"},X={class:"mb-3"},Y=t("label",{class:"form-label"},"Имя",-1),Z={class:"mb-3"},tt=t("label",{class:"form-label"},"Предмет",-1),et=["value"],st=t("div",{class:"form-text"},"Это короткое имя которое будет видеть педагог",-1),lt={class:"mb-3"},at=t("label",{class:"form-label"},"Файл плана",-1),ot=["href"],nt=t("div",{class:"form-text"},"Планы автоматически обработаются в системе",-1),rt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1),it={__name:"PlanModal",props:["plan"],emits:["reGet"],setup(m,{emit:_}){const l=m,e=F({id:"",name:"",subject:"",url:""});L(l,()=>{e.id=l.plan.id===void 0?0:l.plan.id,e.name=l.plan.name,e.subject=l.plan.subject,e.url=l.plan.url===void 0?"":l.plan.url});const n=p([]);b.get(h+"/get/all/subject[*]").then(s=>{n.value=s.data.subjects});const c=p(),a=s=>n.value.filter(o=>o.name===s)[0].id,r=()=>{let s={};s.id=e.id,s.subject_id=a(e.subject),s.name=e.name,console.log(s),b({url:h+"/post/plan",method:"POST",data:s,headers:{"Content-Type":"multipart/form-data",token:JSON.parse(localStorage.getItem("user")).token}}).then(o=>{g.go()})};return(s,o)=>(i(),d("div",H,[t("div",K,[t("div",q,[Q,t("div",W,[t("div",X,[Y,y(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=u=>e.name=u)},null,512),[[P,e.name]])]),t("div",Z,[tt,y(t("select",{class:"form-select","onUpdate:modelValue":o[1]||(o[1]=u=>e.subject=u)},[(i(!0),d($,null,k(n.value,u=>(i(),d("option",{value:u},v(u.name),9,et))),256))],512),[[j,e.subject]]),st]),t("div",lt,[at,t("p",null,[e.url!==""?(i(),d("a",{key:0,href:S(w)+"/"+e.url,download:""},"Скачать текущий план",8,ot)):M("",!0)]),t("input",{type:"file",class:"form-control",onChange:o[2]||(o[2]=u=>{c.value=u.target.files[0]})},null,32),nt])]),t("div",{class:"modal-footer"},[rt,t("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:r},"Сохранить")])])])]))}},bt={__name:"MakePlan",setup(m){const _=p(""),l=c=>{_.value=c},e=p(""),n=c=>{e.value=c,new V("#plan").toggle()};return(c,a)=>(i(),d($,null,[f(it,{plan:e.value},null,8,["plan"]),f(z,{onSetFilter:l,onSetPlan:n}),f(A,{filter_by:_.value,onSetPlan:n},null,8,["filter_by"])],64))}};export{bt as default};
